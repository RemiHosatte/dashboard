<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <!--  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="http://d3js.org/d3.v4.min.js" type="text/javascript"></script>
-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script>
 d3version3 = d3
 window.d3 = null
</script>
 <script src="http://d3js.org/d3.v4.min.js"></script>
 <script>

   // test it worked
   console.log('v3', d3version3.version)
 </script>
  <script src="scripthorloge.js"></script>


</head>
<body>
  <div class="container-fluid no-padding">
      <div class="row">
        <div class="col-sm-4 no-padding">
          <div class="containerPerso dateHeureContainer">
              <div id="div_horloge"></div>
              <div id="div_date"></div>
          </div>
        </div>
        <div class="col-sm-3 no-padding tempHumicontainer">
          <div class="containerPerso temperature">
                  <div class="properties">
                    <div class="now">
                      00°C
                    </div>
                    <div class="min">
                      <div class="text">
                        Min:
                      </div>
                      <div class="value">
                       00°C
                      </div>
                    </div>
                    <div class="max">
                      <div class="text">
                        Max:
                      </div>
                      <div class="value">
                       00°C
                      </div>
                    </div>
                  </div>
                  <div class="lineChartTemp">
                    <svg id="chartTemp"width="300" height="150"></svg>
                  </div>
          </div>
          <div class="containerPerso temperature">
              <div id="chart" class="chart-container">

              </div>
              <div class="properties">
                <div class="now">
                  00°C
                </div>
                <div class="min">
                  <div class="text">
                    Min:
                  </div>
                  <div class="value">
                   00°C
                  </div>
                </div>
                <div class="max">
                  <div class="text">
                    Max:
                  </div>
                  <div class="value">
                   00°C
                  </div>
                </div>
              </div>

            </div>
            </div>
            <div class="col-sm-5 no-padding">
              <div class="col-sm-4 no-padding containerPerso humiditeSol">
                <div class="sensorName">
                  SensorName
                </div>
                <div class="svg">
                  <svg id="fillgauge0" width="100%" height="100%"></svg>
                </div>
              </div>
              <div class="col-sm-4 no-padding containerPerso humiditeSol">
                <div class="sensorName">
                  SensorName
                </div>
                <div class="svg">
                  <svg id="fillgauge1" width="100%" height="100%"></svg>
                </div>
              </div>
              <div class="col-sm-4 no-padding containerPerso humiditeSol">
                <div class="sensorName">
                  SensorName
                </div>
                <div class="svg">
                  <svg id="fillgauge2" width="100%" height="100%"></svg>
                </div>
              </div>

              <div class="col-sm-4 no-padding containerPerso humiditeSol">
                <div class="sensorName">
                  SensorName
                </div>
                <div class="svg">
                  <svg id="fillgauge3" width="100%" height="100%"></svg>
                </div>
              </div>
              <div class="col-sm-4 no-padding containerPerso humiditeSol">
                <div class="sensorName">
                  SensorName
                </div>
                <div class="svg">
                  <svg id="fillgauge4" width="100%" height="100%"></svg>
                </div>
              </div>
              <div class="col-sm-4 no-padding containerPerso humiditeSol">
                <div class="sensorName">
                  SensorName
                </div>
                <div class="svg">
                  <svg id="fillgauge5" width="100%" height="100%"></svg>
                </div>
              </div>
        </div>
      </div>

      </div class="row">


      <div class="widget">
          <div class="header">Progress Status</div>
          <div id="chart" class="chart-container">

          </div>
      </div>


      <script type="text/javascript">

          var percent = 55;

          var w=175,h=175;

          var outerRadius=(w/2)-10;
          var innerRadius=outerRadius-8;


          var color = ['#e95124','#2a3a46','#202b33'];

          var arc=d3version3.svg.arc()
                  .innerRadius(innerRadius)
                  .outerRadius(outerRadius)
                  .startAngle(0)
                  .endAngle(2*Math.PI);

          //The circle is following this
          var arcDummy=d3version3.svg.arc()
                  .innerRadius((outerRadius-innerRadius)/2+innerRadius)
                  .outerRadius((outerRadius-innerRadius)/2+innerRadius)
                  .startAngle(0);


          var arcLine=d3version3.svg.arc()
                  .innerRadius(innerRadius)
                  .outerRadius(outerRadius)
                  .startAngle(0);

          var svg=d3version3.select("#chart")
                  .append("svg")
                  .attr({
                      width:w,
                      height:h,
                      class:'shadow'
                  }).append('g')
                  .attr({
                      transform:'translate('+w/2+','+h/2+')'
                  });


          //background
          var path=svg.append('path')
                  .attr({
                      d:arc
                  })
                  .style({
                      fill:color[1]
                  });


          var pathForeground=svg.append('path')
                  .datum({endAngle:0})
                  .attr({
                      d:arcLine
                  })
                  .style({
                      fill:color[0]
                  });

          //Dummy Arc for Circle
          var pathDummy=svg.append('path')
                  .datum({endAngle:0})
                  .attr({
                      d:arcDummy
                  }).style({
                      fill:color[0]
                  });

          var endCircle=svg.append('circle')
                  .attr({
                      r:8,
                      transform:'translate(0,'+ (-outerRadius+15) +')'
                  })
                  .style({
                      stroke:color[0],
                      'stroke-width':5,
                      fill:color[2]
                  });

          var middleTextCount=svg.append('text')
                  .datum(0)
                  .text(function(d){
                      return d+'%';
                  })

                  .attr({
                      class:'middleText',
                      'text-anchor':'middle',
                      dy:15,
                      dx:0
                  })
                  .style({
                      fill:'#e95124',
                      'font-size':'45px'

                  });


          var arcTweenOld=function(transition, percent,oldValue) {
              transition.attrTween("d", function (d) {

                  var newAngle=(percent/100)*(2*Math.PI);

                  var interpolate = d3version3.interpolate(d.endAngle, newAngle);

                  var interpolateCount = d3version3.interpolate(oldValue, percent);


                  return function (t) {
                      d.endAngle = interpolate(t);
                      var pathForegroundCircle = arcLine(d);

                      middleTextCount.text(Math.floor(interpolateCount(t))+'%');

                      var pathDummyCircle = arcDummy(d);

                      console.log(pathDummyCircle);

                      var coordinate = pathDummyCircle.split("L")[1].split("A")[0];

                      console.log(coordinate);

                      endCircle.attr('transform', 'translate(' + coordinate+ ')');

                      return pathForegroundCircle;
                  };
              });
          };

          var oldValue=0;

          var animate=function(){
              pathForeground.transition()
                      .duration(750)
                      .ease('cubic')
                      .call(arcTweenOld,percent,oldValue);

              oldValue=percent;
              percent=(Math.random() * 60) + 20;
              setTimeout(animate,3000);
          };

          setTimeout(animate,0);

      </script>


</body>

<script src="liquidFillGauge.js" type="text/javascript"></script>
<script src="liquidGaugeCustom.js" type="text/javascript"></script>
<script src="scriptLineChartTemp.js" type="text/javascript"></script>
</html>
